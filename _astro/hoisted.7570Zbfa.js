const u=document.getElementById("searchButton"),t=document.getElementById("searchModal"),p=document.getElementById("closeSearch"),s=document.getElementById("searchInput"),a=document.getElementById("searchResults");let n=null;async function d(){if(typeof window<"u"&&!n)try{n=await window.pagefind,n||console.log("Pagefind not initialized. It will be available after build.")}catch{console.log("Pagefind not available in development mode. Will work after build.")}}u?.addEventListener("click",()=>{t.classList.remove("hidden"),s?.focus(),d()});p?.addEventListener("click",()=>{t.classList.add("hidden"),s.value="",a.innerHTML='<div class="p-6 text-center text-gray-400"><p>Comece a digitar para buscar...</p></div>'});document.addEventListener("keydown",e=>{e.key==="Escape"&&t.classList.add("hidden"),(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),t.classList.remove("hidden"),s?.focus(),d())});t?.addEventListener("click",e=>{e.target===t&&t.classList.add("hidden")});s?.addEventListener("input",async e=>{const i=e.target.value.trim();if(!i){a.innerHTML='<div class="p-6 text-center text-gray-400"><p>Comece a digitar para buscar...</p></div>';return}if(n||await d(),!n){a.innerHTML='<div class="p-6 text-center text-gray-400"><p>Busca disponível apenas após build da produção.</p></div>';return}try{const r=await n.search(i);if(r.results.length===0){a.innerHTML='<div class="p-6 text-center text-gray-400"><p>Nenhum resultado encontrado para "<strong>'+i+'</strong>"</p></div>';return}let o="";for(const l of r.results){const c=await l.data();o+=`
                    <a href="${c.url}" class="block px-6 py-4 border-b border-gray-800 hover:bg-gray-800 transition">
                        <h3 class="text-white font-semibold mb-1">${c.title}</h3>
                        <p class="text-gray-400 text-sm line-clamp-2">${c.excerpt}</p>
                    </a>
                `}a.innerHTML=o}catch(r){console.error("Erro na busca:",r),a.innerHTML='<div class="p-6 text-center text-gray-400"><p>Erro ao buscar. Tente novamente.</p></div>'}});
